<!-- MultiStep Form -->
<div class="container-fluid" id="grad1" style="height: auto !important;">
  <div class="row justify-content-center mt-0">
    <div
      class="col-11 col-sm-9 col-md-7 col-lg-6 text-center p-0 mt-3 mb-2"
    >
      <div class="card px-0 pt-4 pb-0 mt-3 mb-3">
        <h2><strong>Thanh Toán</strong></h2>
        <div class="row">
          <div class="col-md-12 mx-0">
            <form id="msform" method="post" [formGroup]="paymentForm">
              <!-- progressbar -->
              <ul id="progressbar">
                <li class="active" id="delivery-address">
                  <strong>Địa chỉ gửi hàng</strong>
                </li>
                <li id="delivery-format-title">
                  <strong>Hình thức giao hàng</strong>
                </li>
                <li id="checkout-format">
                  <strong>Hình thức thanh toán</strong>
                </li>
                <li id="confirm"><strong>Tình trạng đơn hàng</strong></li>
              </ul>

              <!-- Địa chỉ thanh toán -->
              <fieldset>
                <div class="form-card">
                  <h2 class="fs-title">Địa chỉ gửi hàng</h2>
                  <input
                    type="text"
                    placeholder="Họ và tên*"
                    formControlName="userName"
                  />
                  <select (change)="changeDistrict($event)">
                    <option disabled selected>Thành phố/Tỉnh*</option>
                    <option *ngFor="let province of provinces"
                            [value]="province.provinceId">{{province.provinceName}}</option>
                  </select>
                  <select (change)="changeWard($event)">
                    <option disabled selected>Quận/Huyện*</option>
                    <option *ngFor="let district of districts"
                            [value]="district.districtId">{{district.districtName}}</option>
                  </select>
                  <select formControlName="ward">
                    <option disabled [ngValue]="null" selected>Phường/Xã*</option>
                    <option *ngFor="let ward of wards"
                            [ngValue]="ward">{{ward.wardName}}</option>
                  </select>
                  <span class="text-danger" style="font-size: 12px"
                        *ngIf="paymentForm.controls.ward.errors?.required && (paymentForm.controls.ward?.touched ||paymentForm.controls.ward?.dirty)"><i
                    class="fa fa-exclamation-circle"></i><i> Thành phố/Tỉnh, Quận/Huyện, Phường/Xã chưa chọn !</i>
                  </span>
                  <input type="text" placeholder="Địa chỉ*" formControlName="address"/>
                  <span class="text-danger" style="font-size: 12px"
                        *ngIf="paymentForm.controls.address.errors?.required && (paymentForm.controls.address?.touched ||paymentForm.controls.address?.dirty)"><i
                    class="fa fa-exclamation-circle"></i><i> Trường này là bắt buộc</i>
                  </span>
                  <input
                    type="text"
                    placeholder="Email*"
                    formControlName="userEmail"
                  />
                  <input type="text" placeholder="Số điện thoại*" formControlName="phone"/>
                  <span class="text-danger" style="font-size: 12px"
                        *ngIf="paymentForm.controls.phone.errors?.required && (paymentForm.controls.phone?.touched ||paymentForm.controls.phone?.dirty)"><i
                    class="fa fa-exclamation-circle"></i><i> Trường này là bắt buộc</i>
                  </span>
                  <span class="text-danger" style="font-size: 12px"
                        *ngIf="paymentForm.get('phone').hasError('pattern')"><i
                    class="fa fa-exclamation-circle"></i><i> Định dạng không đúng (10 số, bắt đầu bằng 0)</i>
                  </span>
                  <span *ngIf="checkConfirmCode" id="message-confirm-code" style="margin-bottom: 5px">Mã xác nhận đã được gửi về số điện thoại này. Vui lòng xác nhận</span>
                  <br>
                  <button (click)="onCheckConfirm()" id="confirm-code" style="width: 30%;height: 30px; border: none" *ngIf="paymentForm.get('phone').value && paymentForm.get('phone').valid">Gửi mã xác nhận</button>
                  <input style="width: 70%" *ngIf="paymentForm.get('phone').value && paymentForm.get('phone').valid" type="text" placeholder="Mã xác nhận" (change)="isConfirmCode()">
                  <ngx-loading [show]="loading" [config]="{ fullScreenBackdrop: true }"></ngx-loading>
                  <textarea
                    cols="30"
                    rows="5"
                    placeholder="Hướng dẫn giao hàng (không bắt buộc)"
                    style="resize: none"
                    formControlName="guide"
                  ></textarea>
                </div>
                <input
                  type="button"
                  name="next"
                  class="next action-button"
                  value="Tiếp theo"
                  id="test"
                  [disabled]="!paymentForm.valid || !confirmCode"
                />
              </fieldset>

              <!-- Hình thức giao hàng -->
              <fieldset>
                <div class="form-card">
                  <h2 class="fs-title">Hình thức giao hàng</h2>
                  <input
                    type="radio"
                    name="delivery-format"
                    id="delivery-format"
                    checked
                  />
                  <label for="delivery-format"
                  >Giao hàng tiêu chuẩn - giao hàng tận nơi</label
                  >
                </div>
                <input
                  type="button"
                  name="previous"
                  class="previous action-button-previous"
                  value="Quay lại"
                />
                <input
                  type="button"
                  name="make_payment"
                  class="next action-button"
                  value="Tiếp theo"
                />
              </fieldset>

              <!--              hình thức thanh toán-->
              <fieldset>
                <div class="form-card">
                  <h2 class="fs-title">Hình thức thanh toán</h2>
                  <input
                    type="radio"
                    id="non-credit"
                    value="0"
                    checked
                    name="methodPay"
                    formControlName="methodPay"
                    (click)="onCheck1()"
                  />
                  <label for="non-credit">Trả tiền sau khi nhận hàng</label
                  ><br/>
                  <input
                    type="radio"
                    id="checkout-credit"
                    value="1"
                    name="methodPay"
                    formControlName="methodPay"
                    (click)="onCheck2()"
                  />
                  <label for="checkout-credit"
                  >Thanh toán bằng ví điện tử (Paypal)</label
                  ><br>
                  <div #paypal style="width: 35%; margin-left: 10%; display: none" id="paypal-button"></div>
                  <input
                    type="radio"
                    id="terminal-credit"
                    value="0"
                    (click)="onCheck2()"
                  />
                  <label for="terminal-credit">Thanh toán bằng thẻ nội địa</label
                  ><br>
                  <div id="terminal-credit-form" style="margin-left: 10%; display: none">
                    <label class="pay">Tên chủ thẻ*</label>
                    <input type="text" name="holdername" placeholder="" />
                    <div class="row">
                      <div class="col-9">
                        <label class="pay">Số thẻ*</label>
                        <input type="text" name="cardno" placeholder="" />
                      </div>
                      <div class="col-3">
                        <label class="pay">CVC*</label>
                        <input
                          type="password"
                          name="cvcpwd"
                          placeholder="***"
                        />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-3">
                        <label class="pay">Ngày hết hạn*</label>
                      </div>
                      <div class="col-9">
                        <input type="number" placeholder="tháng">
                        <input type="number" placeholder="năm">
                      </div>
                    </div>
                  </div>
                  <h5 style="margin-left: 10%; color: #7b0c32" *ngIf="messagePayment">{{messagePayment}}</h5>
                  <ngx-loading [show]="loading" [config]="{ fullScreenBackdrop: true }"></ngx-loading>
                </div>
                <input
                  type="button"
                  name="previous"
                  class="previous action-button-previous"
                  value="Quay lại"
                />
                <input
                  type="button"
                  name="next"
                  class="next action-button"
                  [disabled]="(!isChecked1) && (isChecked2 && (!messagePayment))"
                  value="Xem hóa đơn"
                  style="width: 20%"
                  (click)="submit()"
                />
              </fieldset>

              <!--              KienTH-->

              <fieldset>
                <div class="form-card" style="color: black" *ngIf="order">
                  <h4 class="text-left pb-2 fs-title">
                    Hình thức thanh toán:
                  </h4>
                  <div class="row border mb-3" style="background-color: wheat">
                    <div class="col-6 pt-2 pb-2 pl-1">
                      <div class="d-flex h-100 justify-content-start align-items-center">
                        <h5 class="m-0" style="font-family: montserrat,serif; font-weight: normal" *ngIf="order.methodPay == 0">
                          Thanh toán khi nhận hàng
                        </h5>
                        <h5 class="m-0" style="font-family: montserrat,serif; font-weight: normal" *ngIf="order.methodPay == 1">
                          Thanh toán qua Paypal
                        </h5>
                      </div>
                    </div>
                  </div>
                  <h4 class="text-left pb-2 fs-title">
                    Hình thức giao hàng:
                  </h4>
                  <div class="row border mb-3" style="background-color: wheat">
                    <div class="col-10 pt-2 pb-2 pl-1">
                      <div class="d-flex h-100 justify-content-start align-items-center">
                        <h5 class="m-0" style="font-family: montserrat,serif; font-weight: normal">
                          Giao hàng tiêu chuẩn - giao hàng tận nơi
                        </h5>
                      </div>
                    </div>
                  </div>
                  <div class="col-12">
                    <h4 class="text-left pb-2 fs-title">
                      Chi tiết đơn hàng số: {{order.orderId}}
                    </h4>
                    <div class="row mb-3">
                      <div class="col-12">
                        <div class="text-left mb-3 border" style="background-color: wheat">
                          <p class="m-0 pl-2 pb-2 pt-2" style="font-family: montserrat,serif; font-weight: normal">
                            <i class="fas fa-user-alt"></i> Người nhận: {{order.userName}}
                          </p>
                          <p class="m-0 pl-2 pb-2" style="font-family: montserrat,serif; font-weight: normal">
                            <i class="fas fa-phone"></i> Số điện thoại: {{order.phone}}
                          </p>
                          <p class="m-0 pl-2 pb-2" style="font-family: montserrat,serif; font-weight: normal">
                            <i class="far fa-envelope"></i> Email: {{order.userEmail}}
                          </p>
                        </div>
                        <div class="border" style="background-color: wheat">
                          <p class="m-0 pl-2 text-left pb-2 pt-2" style="font-family: montserrat,serif; font-weight: normal">
                            <i class="fas fa-map-marked-alt"></i> Địa chỉ: {{order.address}}
                          </p>
                          <div class="row pb-2">
                            <p class="col m-0 pl-2 text-left" style="font-family: montserrat,serif; font-weight: normal">
                              <i class="fas fa-bookmark"></i> {{order.ward.wardName}}
                            </p>
                            <p class="col m-0 text-center" style="font-family: montserrat,serif; font-weight: normal">
                              <i class="fas fa-bookmark"></i> {{order.ward.district.districtName}}
                            </p>
                            <p class="col m-0 pr-2 text-right" style="font-family: montserrat,serif; font-weight: normal">
                              <i class="fas fa-bookmark"></i> {{order.ward.district.province.provinceName}}
                            </p>
                          </div>
                          <p class="m-0 pl-2 text-left pb-2" style="font-family: montserrat,serif; font-weight: normal" *ngIf="order.guide">
                            <i class="fas fa-map-marker-alt"></i> Hướng dẫn giao hàng: {{order.guide}}
                          </p>
                        </div>
                      </div>
                    </div>
                    <div>
                      <table class="table text-center table-bordered">
                        <thead class="thead-dark">
                        <tr>
                          <th class="p-1 col-5 align-middle">Sản phẩm</th>
                          <th class="p-1 align-middle">Số lượng</th>
                          <th class="p-1 align-middle">Tổng giá (VND)</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let product of products">
                          <td>
                            {{product.productName}}
                          </td>
                          <td class="align-middle">{{product.quantity}}</td>
                          <td class="align-middle">{{(product.lastPrice * 1.05) | number}}</td>
                        </tr>
                        <tr>
                          <th colspan="2">Phí giao hàng (VND)</th>
                          <td>50,000</td>
                        </tr>
                        <tr>
                          <th colspan="2" style="font-weight: bold">Tổng tiền (VND)</th>
                          <td>{{(totalInVND + 50000) | number}}</td>
                        </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <input
                  type="button"
                  (click)="generatePdf('open')"
                  class="action-button-previous"
                  style="width: 25%"
                  value="In hóa đơn"
                />
                <input
                  type="button"
                  class="action-button"
                  style="width: 40%"
                  value="Quay lại lịch sử đấu giá"
                />
              </fieldset>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

